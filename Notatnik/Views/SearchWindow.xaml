<Window x:Class="Notatnik.Views.SearchWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:Notatnik.Models"
        xmlns:vm="clr-namespace:Notatnik.ViewModels"
        Title="Wyszukaj notatki"
        Width="950"
        Height="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        DataContext="{Binding RelativeSource={RelativeSource Self}, Path=ViewModel}">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
            <GroupBox Header="Wyszukiwanie" Margin="10,0,0,0" Padding="5">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox x:Name="SearchTextBox"
                     Width="250"
                     Height="25"
                     Margin="0,0,10,0"
                     VerticalContentAlignment="Center"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     ToolTip="Wpisz fragment tytułu, treści, tagu lub folderu..." />

                    <Button Content="Szukaj"
                    Width="80"
                    Height="25"
                    Command="{Binding SearchNotesCommand}"
                    Margin="0,0,10,0"/>

                    <Button Content="Wyczyść"
                    Width="80"
                    Height="25"
                    Command="{Binding ClearCommand}" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Filtry" Margin="10,0,0,0" Padding="5">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <CheckBox Content="Tytuł" Margin="5" IsChecked="{Binding SortByTitle}"/>
                    <CheckBox Content="Folder" Margin="5" IsChecked="{Binding SortByFolder}"/>
                    <CheckBox Content="Treść" Margin="5" IsChecked="{Binding SortByContent}"/>
                    <CheckBox Content="Tagi" Margin="5" IsChecked="{Binding SortByTags}"/>
                </StackPanel>
            </GroupBox>
        </StackPanel>

        <ListView Grid.Row="1"
                  ItemsSource="{Binding SearchResults}"
                  SelectedItem="{Binding SelectedResult}"
                  MouseDoubleClick="ListViewResults_MouseDoubleClick"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                  ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ListView.View>
                <GridView>
                    <!-- tytuł -->
                    <GridViewColumn Header="Tytuł" Width="200">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Title}" TextWrapping="NoWrap"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- podgląd -->
                    <GridViewColumn Header="Podgląd" Width="220">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Snippet}" TextWrapping="NoWrap"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- folder -->
                    <GridViewColumn Header="Folder" Width="140">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Folder.Name}" TextWrapping="NoWrap"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- tagi -->
                    <GridViewColumn Header="Tagi" Width="220">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <ItemsControl ItemsSource="{Binding Tags}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"
                                                       Margin="0,0,5,0"
                                                       Foreground="Gray"
                                                       FontStyle="Italic"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- zmodyfikowano -->
                    <GridViewColumn Header="Zmodyfikowano" Width="130">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ModifiedAt, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
    </Grid>
</Window>
